# DPM-Solver: A Fast ODE Solver for Diffusion Probabilistic Model Sampling in Around 10 Steps

## 摘要

扩散概率模型 (DPMs) 正在成为强大的生成模型。尽管它们具有高质量的生成性能，但 DPMs 仍然存在采样速度慢的问题，因为它们通常需要数百或数千次大型神经网络的顺序函数评估（步骤）来生成一个样本。从 DPMs 采样可以被视为求解相应的扩散常微分方程 (ODEs)。在本文中，我们提出了扩散 ODEs 解的精确公式。该公式通过解析计算解的线性部分，而不是像之前的工作那样将所有项留给黑箱 ODE 求解器。通过变量替换，该解可以简化为神经网络的指数加权积分。基于我们的公式，我们提出了一种快速的、专门的高阶求解器 DPM-Solver，用于具有收敛阶保证的扩散 ODEs。DPM-Solver 适用于离散时间和连续时间 DPMs，无需进一步训练。实验结果表明，DPM-Solver 能够在各种数据集上仅通过 10 到 20 次函数评估生成高质量的样本。我们在 CIFAR10 数据集上通过 10 次函数评估达到了 4.70 的 FID，20 次函数评估达到了 2.87 的 FID，并在各种数据集上相比之前的最先进无训练采样器实现了 4 到 16 倍的加速。

## 引言

扩散概率模型 (DPMs) 是一种新兴的强大生成模型，在许多任务上表现出色，如图像生成、视频生成、文本到图像生成、语音合成以及无损压缩。DPMs 由离散时间随机过程或连续时间随机微分方程 (SDEs) 定义，它们通过学习逐步去除添加到数据点上的噪声。与广泛使用的生成对抗网络 (GANs) 和变分自编码器 (VAEs) 相比，DPMs 不仅能够精确计算似然，还在图像生成方面实现了更好的样本质量。然而，为了获得高质量的样本，DPMs 通常需要数百或数千次大型神经网络的顺序评估，这导致采样速度比单步的 GANs 或 VAEs 慢得多。这样的效率低下成为 DPMs 在下游任务中应用的关键瓶颈，因此设计快速采样器对于 DPMs 来说是一个紧迫的需求。

现有的DPM快速采样器可以分为两类。第一类包括知识蒸馏、噪声水平或样本轨迹学习。这些方法在使用前可能需要昂贵的训练阶段，且其适用性和灵活性可能有限。要将这种方法应用于不同的模型、数据集和采样步数，可能需要非平凡的努力。第二类是无需训练的采样器，这些采样器适用于所有预训练的DPM，且可以通过简单的即插即用方式使用。无需训练的采样器包括采用隐式或解析生成过程、先进的微分方程（DE）求解器和动态规划。然而，这些方法仍然需要大约50次函数评估才能生成高质量样本，与使用约1000次函数评估生成样本的普通采样器相比，仍然耗时较长。

在本工作中，我们将无训练采样器的效率提升到一个新水平，使其能够在“少步采样”模式下生成高质量的样本，在约10步的顺序函数评估内完成采样。我们通过解决DPM的相应扩散常微分方程（ODE）采样问题，仔细检查了扩散ODE的结构。扩散ODE具有半线性结构——它们由数据变量的线性函数和神经网络参数化的非线性函数组成。之前的无训练采样器忽略了这种半线性结构，直接使用黑箱DE求解器。为了利用这种半线性结构，我们通过解析计算解的线性部分，推导出了扩散ODE解的精确公式，从而避免了相应的离散化误差。此外，通过变量替换，解可以简化为神经网络的指数加权积分。这种积分非常特殊，可以通过指数积分器的数值方法高效近似。

我们通过详细的实验，展示了 DPM-Solver 在不同的数据集上能够以极少的函数评估次数生成高质量的样本。在 CIFAR10 数据集上，我们使用 10 次函数评估达到了 4.70 的 FID 分数，使用 20 次函数评估达到了 2.87 的 FID 分数。此外，我们的方法在多个数据集上实现了相比之前最先进的无需训练采样器高达 4 到 16 倍的加速。这些结果表明，DPM-Solver 是一种高效且普遍适用的快速采样算法，适用于各种扩散概率模型 (DPMs)，并且在无需进一步训练的情况下能够直接应用于预训练的模型。

## 结论

我们解决了 DPMs 的快速且无需训练的采样问题。我们提出了 DPM-Solver，这是一种快速、专用的扩散 ODE 无训练求解器，用于在大约 10 次函数评估内实现 DPMs 的快速采样。DPM-Solver 利用了扩散 ODE 的半线性结构，直接近似了扩散 ODE 精确解的简化公式，该公式由噪声预测模型的指数加权积分组成。受到指数积分器数值方法的启发，我们提出了一阶、二阶和三阶的 DPM-Solver，用于近似噪声预测模型的指数加权积分，并提供了理论收敛保证。我们提出了手工设计的步长和自适应步长，并将 DPM-Solver 应用于连续时间和离散时间的 DPMs。实验结果表明，DPM-Solver 可以在各种数据集上通过大约 10 次函数评估生成高质量样本，并且与之前最先进的无训练采样器相比，实现了 4 到 16 倍的加速。

### 限制和广泛影响

尽管 DPM-Solver 在加速方面表现出色，但它是为快速采样设计的，可能不适合加速 DPMs 的似然评估。此外，与常用的 GANs 相比，带有 DPM-Solver 的扩散模型仍然不足以满足实时应用的速度要求。再者，与其他深度生成模型类似，DPMs 可能会被用于生成有害的虚假内容，而所提出的求解器可能进一步放大深度生成模型在恶意应用中的潜在不良影响。